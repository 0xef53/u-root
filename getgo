# This is becoming more of a buildroot script. 
# If it is a one-time thing, do it here.
# The simplest thing is to build a go via
# mount --bind your-go-src /go
# cd /go
# export CGO_ENABLED=0
# cd src && make.bash
# This gives you a go with the right baked-in paths.
# This script assumes you have done that; if not,
# have your arg be the path-to-go
mkdir -p go/bin go/pkg
cp -a $1/go/src $1/go/include $1/go/VERSION.cache $1/go/misc ./go
cp $1/go/bin/go go/bin
cp -a $1/go/pkg/tool go/pkg
echo default > ./go/VERSION
mkdir -p bin

mkdir -p bin
mkdir -p dev etc usr/lib lib64 tmp
cp /etc/localtime etc

# yegads, the world has gone insane and we can't always build static.

libs=`ldd /go/bin/go /go/pkg/tool/linux_amd64/*| grep -v ':' | grep -v not.*dynamic | grep -v vdso | sed s/\(.*// | sed s/.*=.// | sort -u`
echo $libs
# gnu tar strips the leading /, cowardly.
tar hcf - $libs | tar xv
sudo rm -f dev/null
sudo mknod dev/null c 1 3
